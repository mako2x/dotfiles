"+----------------------------------------------------------------------------------------+
" Keybind
"+----------------------------------------------------------------------------------------+
" Scroll
no j 5<C-e>
no k 5<C-y>
no <Down> 5<C-e>
no <Up> 5<C-y>

" History
no <Left> <A-Left>
no <Right> <A-Right>
no <BS> <A-Left>

" Tab Operation
no h gT
no l gt
no b d
no <S-Right> :tabmove! +1<CR>
no <S-Left>  :tabmove! -1<CR>
no <S-Up> :tabonly<CR>
no <S-Down> :tabduplicate<CR>

" Open Tab
no o T
no p P
no P p
no U :undo<Space>
no gn :tabnew<CR>
no gh gH

" Hint
no m F
no F ;F

" Search
no s :tabopen<Space>google<Space>
no c :hbt<Space>
no v YP
noremap <leader>d y tsite:<C-v>

" Bookmarks
no <leader>w thttps://twitter.com/#!/mako2x/main<CR>
no <leader>f tfacebook.com<CR>
no <leader>g thttp://www.google.co.jp/reader/view/?hl=ja&tab=wy<CR>
no <leader>c tgoogle.com/calendar<CR>
no <leader>s thttps://vu8.sfc.keio.ac.jp/sfc-sfs/index.cgi?+en<CR>

" Others
no <leader>a :anc<CR>
no <leader>p :set invprivate<CR>
no <S-y> :copy title<CR>
no <C-Down> :set toolbars=navigation,menu<CR>
no <C-Up> :set toolbars=nonavigation,nomenu<CR>
no ++ <C-a>
no -- <C-x>
cmap <Down> <TAB>
cmap <Up> <S-TAB>
cmap <C-n> <TAB>
cmap <C-p> <S-TAB>
cmap <C-h> <BS>
cmap <C-i> <Tab>
imap <C-h> <BS>
imap <C-i> <Tab>



"+----------------------------------------------------------------------------------------+
" Settings
"+----------------------------------------------------------------------------------------+
set titlestring="Firefox"
set hintchars=hjklum
set ic
set hlsearch
set history=1000
set activate=homepage,quickmark,tabopen,paste
set complete=sl
set showstatuslinks=1
set focuscontent
let g:ldrc_enable = "false"
set! ui.caretWidth=8
set! browser.cache.disk.enable=false
set! browser.cache.memory.enable=true
set! browser.cache.memory.capacity=-1
set! config.trim_on_minimize=true
set! image.mem.min_discard_timeout_ms=6000
set! browser.download.manager.scanWhenDone=false
set! security.dialog_enable_delay=0
:style -name commandline-ime chrome://* #liberator-commandline-command input {ime-mode: inactive:}
set! dom.disable_window_move_resize=true
set! dom.event.contextmenu.enabled=false
set nextpattern=\bnext\b,\bmore\b,next,^次(の)?ページ,\b次.*,→\b,^>$,^(>>|≫)$,^(>|≫),(>|≫)$,^次(へ|の|ペ),^続き,\bnext\b,^>$,^(>>|≫)$,^(>|≫),(>|≫)$,\bmore\b
set previouspattern=\bprev|previous\b,prev,^前(の)?ページ,\b前.*,\b←,^<$,^(<<|≪)$,^(<|≪),(<|≪)$,^前(へ|の|ペ),^戻る,\bprev|previous\b,^<$,^(<<|≪)$,^(<|≪),(<|≪)$


"+----------------------------------------------------------------------------------------+
" Smart Keyword
"+----------------------------------------------------------------------------------------+
js <<EOM
[
  ['google image search','http://www.google.com/images?&q=%s','gi'],
  ['google reader search','http://www.google.com/reader/view/#search/%s/','gr'],
  ['google blog search ','http://www.google.co.jp/#q=%s&tbm=blg','gb'],
  ['google us search','http://www.google.com/webhp?hl=us#&hl=en&q=%s','gu'],
  ['hatena bookmark','http://b.hatena.ne.jp/search/tag?q=%s&users=500','ha'],
  ['twitter search','http://twitter.com/search?q=%s','tw'],
  ['twitter user','http://twitter.com/%s','tu'],
  ['twilog user','http://twilog.org/%s','tl'],
  ['favstar user','http://ja.favstar.fm/users/%s/given','fav'],
  ['github search','https://github.com/search?q=%s','gh'],
  ['youtube search','http://www.youtube.com/results?search_query=%s','yt'],
  ['nico video search','http://www.nicovideo.jp/search/%s','ni'],
  ['cookpad','http://cookpad.com/レシピ/%s','co'],
  ['2ch search','http://www.google.com/search?q=site:2ch.net+%s','2ch']
].forEach(function (b) {
  if (!bookmarks.isBookmarked(b[1])) {
    bookmarks.add(false, b[0], b[1], b[2], ['vimp'], false);
  }
});
EOM



"+----------------------------------------------------------------------------------------+
" Hatena Bookmark
"+----------------------------------------------------------------------------------------+
" https://github.com/hatena/hatena-bookmark-xul/wiki/Vimperator-%E3%81%A7%E3%81%AF%E3%81%A6%E3%81%AA%E3%83%96%E3%83%83%E3%82%AF%E3%83%9E%E3%83%BC%E3%82%AF%E6%8B%A1%E5%BC%B5%E3%82%92%E4%BD%BF%E3%81%86
javascript <<EOF
liberator.globalVariables.hBookmark_shortcuts = {
    hintsAdd     : 'a',
    hintsComment : 'C',
    add          : ['a'],
    comment      : ['C'],
};

liberator.globalVariables.hBookmark_search_interval = 500;
liberator.globalVariables.hBookmark_search_limit = 20;
liberator.globalVariables.hBookmark_search_max_limit = 200;
EOF

javascript if (typeof hBookmark != 'undefined') liberator.loadScript('chrome://hatenabookmark/content/vimperator/plugin/hatenabookmark.js', {__proto__: this});


"+----------------------------------------------------------------------------------------+
" feedSomeKeys_3
"+----------------------------------------------------------------------------------------+
command! -nargs=+ lazy autocmd VimperatorEnter .* <args>
command! -nargs=+ lazyfmapgooglereader  lazy fmap  -urls='http://www\.google\.(co\.jp|com)/reader' <args>
command! -nargs=+ lazyfmapsgooglereader lazy fmaps -urls='http://www\.google\.(co\.jp|com)/reader' <args>
command! -nargs=+ lazyfmapsgoogle lazy fmaps -urls='http://www\.google\.(co\.jp|com)/search\?' <args>
"command! -nargs=+ lazyfmapstwitter lazy fmaps -urls='https://twitter\.com' <args>

" Google Reader
lazyfmapsgooglereader -events=vkeypress A r v O gh ga gs gt gu / ?
lazyfmapsgooglereader -events=vkeypress i,j o,k f,s a,ga w,A
lazyfmapsgooglereader -events=vkeypress <C-1>,1 <C-2>,2

" Google
lazyfmapsgoogle -events=vkeypress <Up> <Down>

" Twitter
command! -nargs=+ lazy autocmd VimperatorEnter .* <args>
lazy fmaps -urls='^https://twitter\.com/' j k ? .
lazy fmaps -urls='^https://twitter\.com/' -events=vkeydown n gh gr gp gf gm gl gs ga gu

" GoogleReader + Tombloo
lazyfmapgooglereader -events=vkeyup <C-t> T
map -urls='http://www\.google\.co\.jp/reader/view' i <C-t>j



"+----------------------------------------------------------------------------------------+
" StatusLine
"+----------------------------------------------------------------------------------------+
javascript <<JS
let statusLine = document.getElementById("liberator-statusline");
let bottomBar = document.getElementById("liberator-bottombar");

// Backword & Forword Button
if(!document.getElementById("history-indicators")) {
  let xml = <hbox id="history-indicators" xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">
    <label value="&lt;" id="back-indicator" class="history-indicator">
      <observes element={document.getElementById("back-button").command} attribute="disabled" />
    </label>
    <label value="&gt;" id="forward-indicator" class="history-indicator">
      <observes element={document.getElementById("forward-button").command} attribute="disabled" />
    </label>
  </hbox>;

  statusLine.appendChild(document.adoptNode(new DOMParser().parseFromString(xml.toXMLString(), "application/xml").documentElement, true));
}

// Bookmark Icon
let (statusBar = document.getElementById("status-bar")) {
  let (id = "star-button") {
    if(!document.getElementById("panel-" + id)) {
      let panel = document.createElement("statusbarpanel");
      panel.setAttribute("id", "panel-" + id);
      let (icon = document.getElementById(id)) {
        icon.setAttribute("class", "");
        panel.appendChild(icon);
      }
      statusBar.insertBefore(panel, statusBar.firstChild);
    }
  }
}

// StatusBar
let (statusBar = document.getElementById("status-bar")) {
  statusBar.style.maxHeight = "20px";
  bottomBar.appendChild(statusBar);
}

// favicon
let (favicon = document.getElementById("page-proxy-stack")) {
  favicon.style.maxWidth = favicon.style.maxHeight = "20px"
  statusLine.insertBefore(favicon, statusLine.firstChild);
}
JS

style -name history-indicators chrome://browser/content/browser.xul <<CSS
  #history-indicators {
    padding: 0 ! important;
  }
  .history-indicator {
    margin: 0 1px ! important;
    color: WindowText;
  }
  .history-indicator[disabled="true"] {
    //visibility: hidden;
  }
CSS



"+----------------------------------------------------------------------------------------+
" Color
"+----------------------------------------------------------------------------------------+
" ==VimperatorColorSchema==
" name: Sweets enhanced by snaka. (Based on 'Sweets')
" ==/VimperatorColorSchema==

hi Hint font-family: monospace; font-size: 15px; font-weight: normal; color: lightyellow; background-color: rgba(30,30,30,.7); border-color: ButtonShadow; border-width: 0px; border-style: solid; padding: 0px 5px 0px 5px; text-transform: uppercase; 

hi HintElem background-color: pink; color: black;
hi HintActive background-color: hotpink; color: white;

"hi StatusLine     color:  CornflowerBlue; background: #000; font-weight: normal; font-size: 12pt;
"hi StatusLineBroken   color:  black; background: #ffa0a0; font-weight: normal; font-size: 12pt;
"hi StatusLineExtended color:  black; background: #a0ffa0; font-weight: normal; font-size: 12pt;
"hi StatusLineSecure   color:  black; background: #a0a0ff; font-weight: normal; font-size: 12pt;

hi Normal     color:  LightYellow;  background: #333; font-size: 12pt;
hi CmdLine    color:  LightYellow;  background: #333; font-size: 14pt;
hi InfoMsg    color:  LightYellow;  background: #333; font-size: 12pt;
hi ModeMsg    color:  LightYellow;  background: #333; font-size: 12pt;
hi MoreMsg    color:  LimeGreen; background: #333;
hi LineNr   color:  DeepPink; background: #333; font-size: 12pt;
hi Question   color: Yellow;  background:#333;  font-size: 12pt;
hi WarningMsg   color: DeepPink;  background:#333;  font-size: 12pt;
hi ErrorMsg   color: white;  background: red;  font-size: 12pt;
hi NonText    background: #333;
hi Null     color: CornflowerBlue;
hi Tag      color: CornflowerBlue;

hi CompTitle    color:  magenta; background: #222; font-weight: bold;
hi CompItem[selected] color: DeepPink;  background: Black;
hi CompDesc   color: Pink;

hi Title    color:  white;
hi Indicator    color:  DodgerBlue;
hi String   color:  Orchid;
hi Number   color:  Orchid;
hi Object   color: Khaki;
hi Function   color:  SkyBlue;
hi URL    color:  LightGreen;

hi TabNumber  color: white; font-weight: bold; font-size: 10pt;


"style -name statusbar chrome://* <<EOM
"#status-bar statusbarpanel { padding: 0 1px !important; }
"statusbarpanel > * { margin: 0 !important; padding: 0 !important; }
"EOM
